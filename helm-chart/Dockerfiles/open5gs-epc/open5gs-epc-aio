FROM ubuntu:focal

ENV DEBIAN_FRONTEND noninteractive

COPY ./open5gs-dbctl /open5gs-dbctl

RUN apt update && apt install -y gnupg2 ca-certificates

RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 656408E390CFB1F5

RUN echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse" | tee /etc/apt/sources.list.d/mongodb-org-4.4.list

RUN apt update && apt install -y mongodb-org-shell=4.4.15

RUN apt-get update && \
   apt-get -yq dist-upgrade && \
   apt-get --no-install-recommends -qqy install python3-pip python3-setuptools python3-wheel ninja-build build-essential flex bison git libsctp-dev libgnutls28-dev libgcrypt-dev libssl-dev vim \
   libidn11-dev libmongoc-dev libbson-dev libyaml-dev libmicrohttpd-dev libcurl4-gnutls-dev meson iproute2 libnghttp2-dev \
   iptables iputils-ping tcpdump cmake curl gnupg meson libtalloc-dev && \ 
   git clone --recursive -b v2.6.1 https://github.com/open5gs/open5gs && \
   cd open5gs && meson build --prefix=/ && ninja -C build && cd build && ninja install

WORKDIR /
